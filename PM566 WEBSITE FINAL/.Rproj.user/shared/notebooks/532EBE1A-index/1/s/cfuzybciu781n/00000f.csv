"0","library(leaflet)"
"0","library(dplyr)"
"0","library(tigris)"
"0","library(sf)"
"0","options(tigris_use_cache = TRUE)"
"0",""
"0","# Filter and calculate mean percentages for Lifetime Diagnosis of Depression"
"0","summarized_data <- clean_mentalhealth_data %>%"
"0","  filter(Topic == ""Lifetime diagnosis of depression"") %>%"
"0","  group_by(LocationDesc) %>%"
"0","  summarize(Mean_Percentage = mean(Data_Value, na.rm = TRUE)) %>%"
"0","  rename(State = LocationDesc)  # Rename for easier matching"
"0",""
"0","# Load state boundaries (simplified for efficiency)"
"0","states <- tigris::states(cb = TRUE, class = ""sf"")"
"2","Retrieving data for the year 2021
"
"0","# Ensure state names match by converting to uppercase"
"0","summarized_data <- summarized_data %>%"
"0","  mutate(State = toupper(State))"
"0",""
"0","# Join state shapefile with summarized data"
"0","states_data <- states %>%"
"0","  mutate(NAME = toupper(NAME)) %>%  # Ensure NAME matches State"
"0","  left_join(summarized_data, by = c(""NAME"" = ""State""))"
"0",""
"0","# Create a Leaflet map for Lifetime Diagnosis of Depression"
"0","leaflet(data = states_data) %>%"
"0","  addPolygons("
"0","    fillColor = ~colorQuantile(""YlOrRd"", Mean_Percentage)(Mean_Percentage),"
"0","    weight = 1,"
"0","    opacity = 1,"
"0","    color = ""white"","
"0","    dashArray = ""3"","
"0","    fillOpacity = 0.7,"
"0","    highlight = highlightOptions("
"0","      weight = 2,"
"0","      color = ""#666"","
"0","      dashArray = """","
"0","      fillOpacity = 0.7,"
"0","      bringToFront = TRUE"
"0","    ),"
"0","    label = ~paste(NAME, ""<br>"", ""Mean %: "", round(Mean_Percentage, 2))"
"0","  ) %>%"
"0","  addLegend("
"0","    ""bottomright"","
"0","    pal = colorQuantile(""YlOrRd"", domain = states_data$Mean_Percentage, n = 5),"
"0","    values = ~Mean_Percentage,"
"0","    title = ""Mean % Diagnosed with Depression"","
"0","    opacity = 1"
"0","  ) %>%"
"0","  # Add title as a top-left control with custom HTML and CSS"
"0","  addControl("
"0","    html = ""<div style='text-align:center; font-size:16px; font-weight:bold;'>Mean Percentage Diagnosed with Depression by State</div>"","
"0","    position = ""topleft"""
"0","  )"
"2","Warning: sf layer has inconsistent datum (+proj=longlat +datum=NAD83 +no_defs).
Need '+proj=longlat +datum=WGS84'"
